<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</head>
<body style="background-color:#262626">
	<font color="white">
    <div id="table_info"></div>
    
    <div id="explanation"></div>
    
    <ul id="requests"></ul>

	<script src="http://pastebin.com/raw.php?i=YZRfhRw3"></script>
	<script src="http://pastebin.com/raw.php?i=WtLCSUwe"></script>
    <script type="text/javascript">
		var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key=1IKrS5uJcT0dahtSlrwJsREUkNHc6Bk1FryaZfnS8bOU';

		//Other Vars: "Timestamp", "Handle", "Level", "Fullfilled", "Fullfilled By", "Cost"
		
		var DebugFlag=0;
				
		var Head=["HeadQuality", "HeadTrait", "HeadMotif", "HeadEnchant", "HeadSet", "HeadCost"];
		var Chest=["ChestQuality", "ChestTrait", "ChestMotif", "ChestEnchant", "ChestSet", "ChestCost"];
		var Legs=["LegsQuality",  "LegsTrait", "LegsMotif", "LegsEnchant", "LegsSet"];
		var Feet=["FeetQuality",  "FeetTrait", "FeetMotif", "FeetEnchant", "FeetSet"];
		var Shoulder=["ShoulderQuality",  "ShoulderTrait", "ShoulderMotif", "ShoulderEnchant", "ShoulderSet"];
		var Hand=["HandQuality",  "HandTrait", "HandMotif", "HandEnchant", "HandSet"];
		var Belt=["BeltQuality",  "BeltTrait", "BeltMotif", "BeltEnchant", "BeltSet"];
		var Shield=["ShieldQuality", "ShieldTrait", "ShieldMotif", "ShieldEnchant", "ShieldSet"];
		var Weapon1=["Weapon1Quality",  "Weapon1Trait", "Weapon1Motif", "Weapon1Enchant",  "Weapon1Set"];
		var Weapon2=["Weapon2Quality", "Weapon2Trait", "Weapon2Motif", "Weapon2Enchant", "Weapon2Set"];
		var Weapon3=["Weapon3Quality", "Weapon3Trait",  "Weapon3Motif", "Weapon3Enchant", "Weapon3Set"];

		var Categories=["Head","Chest","Legs","Feet","Shoulder","Hand","Belt","Shield","Weapon1","Weapon2","Weapon3"];
		//var CategoriesData=[Head,Chest,Legs,Feet,Shoulder,Hand,Belt,Shield,Weapon1,Weapon2,Weapon3];
		var CategoriesPresent= [];
		var EmptyArray=[];
		var ValidWords=[];

		
      $(document).ready( function() {
        Tabletop.init( { key: public_spreadsheet_url,
                         callback: showRequestInfo,
                         wanted: [ "Requests", "Fulfillments" ],
                         debug: false } )
      })
        
	function showRequestInfo(data, tabletop){
		$("<h1><u><b>Current Requests</b></u></h1>").appendTo("#table_info");
		
		var RequestRowData=tabletop.sheets("Requests").all();
		var FulfillmentsRowData=tabletop.sheets("Fulfillments").all();
		
		var i,j,k,l;
		var RequestCounter=1;
		var TotalUsers;
		
		//Exception handling:
		if(RequestRowData.length <=0 ){
			TotalUsers=1;
		}
		else{
			TotalUsers=RequestRowData.length;
		}		
		for(i=0; i < TotalUsers;i++){
			CategoriesPresent=[];
			var found=0;
			var AllMemberData="";
			//See if a request exists (via a Handle and Timestamp) in BOTH of the sheets --> implies the request has been fulfilled
			for(j=0; j < FulfillmentsRowData;j++){
				if(RequestRowData[i].Handle === FulfillmentsRowData[j].Handle && RequestRowData[i].Timestamp === FulfillmentsRowData[j].OrderDate){
					found=1;
				}
			}
			
			if(found === 0){//If the request has NOT been fulfilled, then display
				console.log("\n\nProcessing "+RequestRowData[i].Handle+"'s data...");
				var ItemCategoryFound=0;
				//for(j=0;j<CategoriesData.size();j++){
					//console.log("\tCategoriesData size: "+CategoriesData.size());
					//console.log("\t\tChecking: "+Categories[j]);
					//ItemCategoryFound=CheckForGear(CategoriesData[j],RequestRowData[i]);
					if(CheckForGear(Head,RequestRowData[i])){
						CategoriesPresent.push("Head");
					}
					if(CheckForGear(Chest,RequestRowData[i])){
						//console.log("\tFound a Chest item");
						CategoriesPresent.push("Chest");
					}
					if(CheckForGear(Legs,RequestRowData[i])){
						//console.log("\tFound a Legs item");
						CategoriesPresent.push("Legs");
					}
					if(CheckForGear(Feet,RequestRowData[i])){
						CategoriesPresent.push("Feet");
					}
					if(CheckForGear(Shoulder,RequestRowData[i])){
						CategoriesPresent.push("Shoulder");
					}
					if(CheckForGear(Hand,RequestRowData[i])){
						CategoriesPresent.push("Hand");
					}
					if(CheckForGear(Belt,RequestRowData[i])){
						CategoriesPresent.push("Belt");
					}
					if(CheckForGear(Shield,RequestRowData[i])){
						CategoriesPresent.push("Shield");
					}
					if(CheckForGear(Weapon1,RequestRowData[i])){
						CategoriesPresent.push("Weapon1");
					}
					if(CheckForGear(Weapon2,RequestRowData[i])){
						CategoriesPresent.push("Weapon2");
					}
					if(CheckForGear(Weapon3,RequestRowData[i])){
						CategoriesPresent.push("Weapon3");
					}
					
					if(ItemCategoryFound===1){
					//if(CheckForGear(CategoriesData[j],RequestRowData[i])){
						
					}
				//}
				if(CategoriesPresent.length>=1){	
					console.log("\t"+RequestRowData[i].Handle+" has \n\t\t"+CategoriesPresent+" values present");
					AllMemberData=GenerateRequestTabList(Categories,CategoriesPresent,RequestCounter,RequestRowData[i]) + GenerateRequestTabList_Content(Categories,CategoriesPresent,RequestCounter,RequestRowData[i]);
					$(AllMemberData).appendTo("#table_info");
					RequestCounter++;
				}

			}
		}
	}
	
	//function CheckForGear(Categories,RequestorData){
	//	return
	//}
	
	function GenerateRequestTabList(ListForMenu,ListRestrictions,RequestNumber,RequestorData){
		var FirstItemFound=0;
		var MenuList="<hr><h3>Request "+(RequestNumber)+": "+ RequestorData.Handle + "</h3>(submitted on: "+ RequestorData.Timestamp + ")<br>";
		MenuList+="<ul class=\"nav nav-tabs\">";
		for(var k=0; k<ListForMenu.length; k++){
			var ListItemValid=0;
			for(l=0;l<ListRestrictions.length;l++){
				if(ListForMenu[k]===ListRestrictions[l]){
					ListItemValid=1;
					break;
				}
			}
			if(ListItemValid===1){
				console.log("Found "+ListForMenu[k]);
				if(FirstItemFound===0){
					MenuList+="	<li class=\"active\"><a data-toggle=\"tab\" href=\"#"+RequestNumber+RequestorData.Handle+"menu1\">"+ ListForMenu[k] +"</a></li>";
					FirstItemFound=1;
				}
				else{	
					MenuList+="<li><a data-toggle=\"tab\" href=\"#"+RequestNumber+RequestorData.Handle+"menu"+ k +"\">"+ ListForMenu[k] +"</a></li>";
				}
			}
		}
		MenuList+="</ul>";		
		return MenuList;
	}
	
	function GenerateRequestTabList_Content(ListOfItems,ListRestrictions,RequestNumber,RequestorData){
		console.log("\n\tStarting Printing of Request Tab Content");
		var FirstItemFound=0;
		var MenuListData="";
			MenuListData+="<div class=\"tab-content\">";
			for(var k=0; k<ListOfItems.length; k++){
				var ListItemValid=0;
				for(l=0;l<ListRestrictions.length;l++){
					if(ListOfItems[k]===ListRestrictions[l]){
						//console.log("\t\tComparing "+ListOfItems[k]+" to "+ListRestrictions[l]);
						ListItemValid=1;
						break;
					}
				}
				if(ListItemValid===1){
				console.log("Found "+ListOfItems[k]);
				if(FirstItemFound===0){
						MenuListData+="<div id=\""+RequestNumber+RequestorData.Handle+"menu"+k+"\" class=\"tab-pane fade in active\" style=\"color:white;\">";
						FirstItemFound=1;
					}
					else{
						MenuListData+="<div id=\""+RequestNumber+RequestorData.Handle+"menu"+k+"\" class=\"tab-pane fade in\" style=\"color:white;\">";
					}
					MenuListData+="			<h3>"+ListOfItems[k]+"</h3>";
					MenuListData+="				<p>";
					MenuListData+="					Test";
					MenuListData+="				</p>";
					MenuListData+="		</div>";
				}
			}
			MenuListData+="</div>";
		return MenuListData;
	}
	
	function CheckForGear(ItemArray, Data){
		//DEBUGGGING: Dump all the fields
		//console.log("This is the ItemArray: "+ItemArray);
		for(var i=0; i<ItemArray.length;i++){
			var TestString="";
			console.log("\t\tThis is "+ItemArray[i]+"'s data: "+Data[ItemArray[i]]);
			if(Data[ItemArray[i]]!=undefined){
				if(Data[ItemArray[i]].length>=3){
					
					return 1;				
				}
			}
		} 
		return 0;
	}
	  

    </script>
	</font>

  </body>
</html>

<!--

		/*
		Array.prototype.atIndices = function(ind) {
			var result = [];
			for (var i = 0; i < arguments.length; i++) {
				if (arguments[i] in this)
					result.push(this[arguments[i]])
				}
			return result;        
		}
		*/
		
		/*
		function pluck(arr, indices) {
			var result = [];
			var result2 = [];
			i = 0;
			len = indices.length;

			for (; i < len; i++) {
				result.push(arr[indices[i]]);
			}
			if(result===result2){
				return null;
			}
			else{
				return result;
			}
		}
		*/


!-->