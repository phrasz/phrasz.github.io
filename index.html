<!DOCTYPE html>
<html>
  <body>
  <font color="white">
  <!--<font color="black">!-->
    <div id="table_info"></div>
    
    <div id="explanation"></div>
    
    <ul id="requests"></ul>

    <!-- Don't need jQuery for Tabletop, but using it for this example -->
    <!-- <script type="text/javascript" src="https://raw.githubusercontent.com/jsoma/tabletop/master/examples/common/jquery.js"></script> !-->
	<script src="http://pastebin.com/raw.php?i=YZRfhRw3"></script>
    <!-- <script type="text/javascript" src="https://raw.githubusercontent.com/jsoma/tabletop/master/src/tabletop.js"></script> !-->
	<script src="http://pastebin.com/raw.php?i=WtLCSUwe"></script>
    <script type="text/javascript">
      //var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key=0AmYzu_s7QHsmdE5OcDE1SENpT1g2R2JEX2tnZ3ZIWHc&output=html';
		var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key=1IKrS5uJcT0dahtSlrwJsREUkNHc6Bk1FryaZfnS8bOU';

      $(document).ready( function() {
        Tabletop.init( { key: public_spreadsheet_url,
                         callback: showInfo,
                         wanted: [ "Requests", "Fulfillments" ],
                         debug: false } )
      })
        
      function showInfo(data, tabletop) {
		var cat_li;
	    //$("#table_info").text("We found the tables " + tabletop.model_names.join(", "));  

		/*
		$.each( tabletop.sheets(), function(i, sheet) {
			$("#table_info").append("<p>" + sheet.name + " has " + sheet.column_names.join(", ") + "</p>");
		});
		*/
		
//        $("#table_info").text("");
		cat_li=$('<h2>Current Requests:</h2>');
		cat_li.appendTo("#table_info");
        
		$.each( tabletop.sheets("Requests").all(), function(i, requestsData) {
			var found=0;
			var name="example";
			//Parse through the Fulfillment table for a match between requests and fulfillments
			$.each( tabletop.sheets("Fulfillments").all(), function(i, fullfillData) {
				if(requestsData.Handle === fullfillData.Handle && requestsData.Timestamp === fullfillData.OrderDate){
					found=1;
				}

			})

			if(found === 0){//If the request has NOT been fulfilled, then display
					cat_li = $('<h4>' + requestsData.Handle + " (submitted on: "+ requestsData.Timestamp + ')</h4>');
					cat_li.appendTo("#table_info");
					printed=1;
			}
			cat_li.appendTo("#table_info");
        })
	

	}
	  

    </script>
  </font>
  </body>
</html>